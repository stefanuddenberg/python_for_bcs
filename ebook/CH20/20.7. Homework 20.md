# 20.7. Homework 20

For Homework 20, you will turn our Chapter 20 demo (from the lab) into a more complete mini online
experiment. In addition to getting the survey to work and saving responses, you will implement
**TIPI scoring**, including **reverse scoring**, and store the computed trait scores in your
database.

Your goals are:

- Serve the **full 10-item TIPI** survey as an HTML form
- Accept submissions with FastAPI
- Save raw responses to a SQLite database using SQLModel
- Compute the **Big Five trait scores** (including reverse scoring) on the server when the form is submitted
- Save the computed scores to the database
- Provide an experimenter-friendly way to view and export the data

## Project folder

Create a folder called `HW20/` (or reuse your Chapter 20 project folder and rename it). Inside it you
should have:

- `main.py`
- `models.py`
- `database.py`
- `templates/`
  - `survey.html`
  - `thank_you.html`
- `populate_db.py` (you will create this file yourself)

## Part 1: The full TIPI survey (HTML)

Put the contents below into `templates/survey.html` for the full survey.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>TIPI Survey</title>
  </head>
  <body>
    <h1>Personality Survey</h1>

    <p>
      Here are a number of personality traits that may or may not apply to you.
      Please indicate the extent to which you agree or disagree with each
      statement using a scale from 1 to 7, where 1 means "disagree strongly" and
      7 means "agree strongly". You should rate the extent to which the pair of
      traits applies to you, even if one characteristic applies more strongly
      than the other.
    </p>

    <form method="post" action="/submit">
      <ol>
        <li>
          <p><strong>I see myself as:</strong> Extraverted, enthusiastic.</p>
          <label for="tipi_1">Rating:</label>
          <select id="tipi_1" name="tipi_1" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>

        <li>
          <p><strong>I see myself as:</strong> Critical, quarrelsome.</p>
          <label for="tipi_2">Rating:</label>
          <select id="tipi_2" name="tipi_2" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>

        <li>
          <p><strong>I see myself as:</strong> Dependable, self-disciplined.</p>
          <label for="tipi_3">Rating:</label>
          <select id="tipi_3" name="tipi_3" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>

        <li>
          <p><strong>I see myself as:</strong> Anxious, easily upset.</p>
          <label for="tipi_4">Rating:</label>
          <select id="tipi_4" name="tipi_4" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>

        <li>
          <p>
            <strong>I see myself as:</strong> Open to new experiences, complex.
          </p>
          <label for="tipi_5">Rating:</label>
          <select id="tipi_5" name="tipi_5" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>

        <li>
          <p><strong>I see myself as:</strong> Reserved, quiet.</p>
          <label for="tipi_6">Rating:</label>
          <select id="tipi_6" name="tipi_6" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>

        <li>
          <p><strong>I see myself as:</strong> Sympathetic, warm.</p>
          <label for="tipi_7">Rating:</label>
          <select id="tipi_7" name="tipi_7" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>

        <li>
          <p><strong>I see myself as:</strong> Disorganized, careless.</p>
          <label for="tipi_8">Rating:</label>
          <select id="tipi_8" name="tipi_8" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>

        <li>
          <p><strong>I see myself as:</strong> Calm, emotionally stable.</p>
          <label for="tipi_9">Rating:</label>
          <select id="tipi_9" name="tipi_9" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>

        <li>
          <p><strong>I see myself as:</strong> Conventional, uncreative.</p>
          <label for="tipi_10">Rating:</label>
          <select id="tipi_10" name="tipi_10" required>
            <option value="" selected>Please select an option</option>
            <option value="1">1 (disagree strongly)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4 (neither agree nor disagree)</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7 (agree strongly)</option>
          </select>
        </li>
      </ol>

      <div>
        <label for="comments">Any additional comments? (optional)</label><br />
        <textarea id="comments" name="comments" rows="4" cols="60"></textarea>
      </div>

      <button type="submit">Submit</button>
    </form>
  </body>
</html>
```

## Part 2: Updating your data models

Update `models.py` so your database stores:

- Raw TIPI responses: `tipi_1` … `tipi_10` (integers between 1 and 7)
- Optional `comments` string (up to 2000 characters long)
- Computed Big Five scores (floats):
  - `extraversion`
  - `agreeableness`
  - `conscientiousness`
  - `emotional_stability`
  - `openness`
    - To compute these scores, you will need to implement the scoring logic in your `/submit` route and add the computed scores to the entry in the database.
- Server-generated fields: `id`, `created_at`

All raw items input by the user must validate as integers 1-7 using `Field(ge=1, le=7)`. Optional comments should be a string with a maximum length of 2000 characters.

## Part 3: Implement trait scoring of the Big Five

While half of the questions are straightforward to score, half of them are reverse-scored. E.g., if the user entered a 7 for question 1, that should be scored as 1 (a 6 would become 2, a 5 would become 3, etc.).

The formula for reverse scoring is `reverse(x) = 8 - x`. 8 because it's the maximum score (7) plus 1.

The trait scores are computed as the mean of the two items that make up the trait. For example, extraversion is the mean of item 1 and the reverse of item 6.

### TIPI key (which questions go with which trait)

Compute the trait scores using the standard TIPI structure (2 items per trait):

- **Extraversion** — items 1 and 6 (reverse-scored)
- **Agreeableness** — items 2 (reverse-scored) and 7
- **Conscientiousness** — items 3 and 8 (reverse-scored)
- **Emotional Stability** — items 4 (reverse-scored) and 9
- **Openness** — items 5 and 10 (reverse-scored)

Again, the reverse-scored items are **2, 4, 6, 8, 10** and the standard items are **1, 3, 5, 7, 9**.

### Requirement

Implement a function (in `main.py` or a helper module) that:

- receives `tipi_1` through `tipi_10` as integers
- performs reverse scoring where appropriate
- returns the five trait scores as floating point numbers

Then update your `/submit` route so it:

1. reads form inputs
2. converts them to ints
3. computes the trait scores
4. saves everything to the database

## Part 4: Experimenter features

Add the following routes:

1. `GET /summary`

   - returns JSON summarizing the data collected so far
   - includes the number of responses collected
   - includes the mean and standard deviation for each trait score

   Your JSON should have at least these keys:

   - `n_responses`
   - `means` (a dictionary)
   - `stds` (a dictionary)

   For example, the JSON should look roughly like:

   ```json
   {
     "n_responses": 42,
     "means": {
       "extraversion": 4.9,
       "agreeableness": 5.1,
       "conscientiousness": 4.2,
       "emotional_stability": 3.8,
       "openness": 5.6
     },
     "stds": {
       "extraversion": 1.1,
       "agreeableness": 0.9,
       "conscientiousness": 1.3,
       "emotional_stability": 1.4,
       "openness": 1.0
     }
   }
   ```

2. `GET /export_to_csv`
   - returns a CSV download of all responses
   - includes raw item responses and computed scores

## Part 5: Seed script

Create `populate_db.py` that inserts **at least 30** fake responses into the database so you can test your two new endpoints from Part 4.

Your `populate_db.py` script must:

- generate random ints 1-7 as responses for each survey question (tipi_1 to tipi_10)
- include optional `comments` on some (but not all!) rows
  - Use a 30% probability to decide whether to include a comment
  - A comment can be a random string of 10-30 characters
  - Make sure to compute the trait scores for each response and save them to the database

## What to submit

Submit a zip file named `lastname_firstname_hw20.zip`

It must include the following:

- your entire `HW20/` folder
- your automatically populated `survey.db` database file

As a reminder, the project should run _as-is_ when we unzip it and run `uvicorn main:app --reload`. If it does not, then it will not be graded.

Next: TBD<br>
Previous: [20.6. Lab 20](20.6.%20Lab%2020.md)
